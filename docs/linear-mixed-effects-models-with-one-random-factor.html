<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Linear mixed-effects models with one random factor | Learning Statistical Models Through Simulation in R</title>
<meta name="author" content="Dale J. Barr">
<meta name="description" content="This chapter is under construction as of October 08, 2021; contents may change!  6.1 Learning objectives understand how linear mixed-effects models can replace conventional analyses, and when they...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 6 Linear mixed-effects models with one random factor | Learning Statistical Models Through Simulation in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/stat-models-v1/linear-mixed-effects-models-with-one-random-factor.html">
<meta property="og:image" content="https://psyteachr.github.io/stat-models-v1/images/logos/logo.png">
<meta property="og:description" content="This chapter is under construction as of October 08, 2021; contents may change!  6.1 Learning objectives understand how linear mixed-effects models can replace conventional analyses, and when they...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Linear mixed-effects models with one random factor | Learning Statistical Models Through Simulation in R">
<meta name="twitter:description" content="This chapter is under construction as of October 08, 2021; contents may change!  6.1 Learning objectives understand how linear mixed-effects models can replace conventional analyses, and when they...">
<meta name="twitter:image" content="https://psyteachr.github.io/stat-models-v1/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-6NP3MF25W3');
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Learning Statistical Models Through Simulation in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="understanding-correlation-and-regression-through-bivariate-simulation.html"><span class="header-section-number">2</span> Understanding correlation and regression through bivariate simulation</a></li>
<li><a class="" href="multiple-regression.html"><span class="header-section-number">3</span> Multiple regression</a></li>
<li><a class="" href="interactions.html"><span class="header-section-number">4</span> Interactions</a></li>
<li><a class="" href="introducing-linear-mixed-effects-models.html"><span class="header-section-number">5</span> Introducing Linear Mixed-Effects Models</a></li>
<li><a class="active" href="linear-mixed-effects-models-with-one-random-factor.html"><span class="header-section-number">6</span> Linear mixed-effects models with one random factor</a></li>
<li><a class="" href="linear-mixed-effects-models-with-crossed-random-factors.html"><span class="header-section-number">7</span> Linear mixed-effects models with crossed random factors</a></li>
<li><a class="" href="generalized-linear-mixed-effects-models.html"><span class="header-section-number">8</span> Generalized linear mixed-effects models</a></li>
<li><a class="" href="modeling-ordinal-data.html"><span class="header-section-number">9</span> Modeling Ordinal Data</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="symbols.html"><span class="header-section-number">A</span> Symbols</a></li>
<li><a class="" href="bibliography.html"><span class="header-section-number">B</span> Bibliography</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/stat-models-v1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="linear-mixed-effects-models-with-one-random-factor" class="section level1">
<h1>
<span class="header-section-number">6</span> Linear mixed-effects models with one random factor<a class="anchor" aria-label="anchor" href="#linear-mixed-effects-models-with-one-random-factor"><i class="fas fa-link"></i></a>
</h1>
<div class="warning">
<p>This chapter is under construction as of October 08, 2021; contents may change!</p>
</div>
<div id="learning-objectives-1" class="section level2">
<h2>
<span class="header-section-number">6.1</span> Learning objectives<a class="anchor" aria-label="anchor" href="#learning-objectives-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>understand how linear mixed-effects models can replace conventional analyses, and when they are appropriate</li>
<li>express various types of common designs in a regression framework</li>
<li>use model comparison (<code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code>) for testing effects</li>
<li>express various study designs using the R regression formula syntax</li>
</ul>
</div>
<div id="when-and-why-would-you-want-to-replace-conventional-analyses-with-linear-mixed-effects-modeling" class="section level2">
<h2>
<span class="header-section-number">6.2</span> When, and why, would you want to replace conventional analyses with linear mixed-effects modeling?<a class="anchor" aria-label="anchor" href="#when-and-why-would-you-want-to-replace-conventional-analyses-with-linear-mixed-effects-modeling"><i class="fas fa-link"></i></a>
</h2>
<p>We have repeatedly emphasized how many common techniques in psychology can be seen as special cases of the general linear model. This implies that it would be possible to replace these techniques with regression. In fact, you could analyze almost any conceivable dataset in psychology using one of the four functions below:</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="15%">
<col width="31%">
<col width="15%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th align="left">sampling design</th>
<th align="left">type of data</th>
<th align="left">function</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">single level</td>
<td align="left">continuous, normally distributed</td>
<td align="left"><code>base::lm()</code></td>
<td align="left">simple linear model</td>
</tr>
<tr class="even">
<td align="left">single level</td>
<td align="left">count or categorical</td>
<td align="left"><code>base::glm()</code></td>
<td align="left">generalized linear model</td>
</tr>
<tr class="odd">
<td align="left">multilevel</td>
<td align="left">continuous, normally distributed</td>
<td align="left"><code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lme4::lmer()</a></code></td>
<td align="left">linear mixed-effects model</td>
</tr>
<tr class="even">
<td align="left">multilevel</td>
<td align="left">count or categorical</td>
<td align="left"><code><a href="https://rdrr.io/pkg/lme4/man/glmer.html">lme4::glmer()</a></code></td>
<td align="left">generalized linear mixed-effects model</td>
</tr>
</tbody>
</table></div>
<p>To decide which function to use, you need to know the type of data you're working with (continuous and normally distributed, or not) and how the data have been sampled (single-level or <a class="glossary" target="_blank" title="(or multi-level) Relating to datasets where there are multiple observations taken on the same variable on the same sampling units (usually subjects or stimuli)." href="https://psyteachr.github.io/glossary/m#multilevel">multilevel</a>). Arguments to these functions are highly similar across all four versions. We will learn about analyzing count and categorical data later in this course. For now, we will focus on continuous data, but many of the principles are identical.</p>
<p>Here is a comparison chart for single-level data (data where you don't have <a class="glossary" target="_blank" title="A dataset has repeated measures if there are multiple measurements taken on the same variable for individual sampling units." href="https://psyteachr.github.io/glossary/r#repeated-measures">repeated-measures</a>):</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">test</th>
<th align="left">conventional approach</th>
<th align="left">regression approach</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">one-sample t-test</td>
<td align="left"><code><a href="https://rdrr.io/r/stats/t.test.html">t.test(y, mu = c)</a></code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/lm.html">lm(y ~ 1, offset = c)</a></code></td>
</tr>
<tr class="even">
<td align="left">independent samples t-test</td>
<td align="left"><code><a href="https://rdrr.io/r/stats/t.test.html">t.test(x, y)</a></code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/lm.html">lm(y ~ x)</a></code></td>
</tr>
<tr class="odd">
<td align="left">one factor ANOVA</td>
<td align="left"><code><a href="https://rdrr.io/r/stats/aov.html">aov(y ~ x)</a></code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/lm.html">lm(y ~ x)</a></code></td>
</tr>
<tr class="even">
<td align="left">factorial ANOVA</td>
<td align="left"><code><a href="https://rdrr.io/r/stats/aov.html">aov(y ~ a * b)</a></code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/lm.html">lm(y ~ a * b)</a></code></td>
</tr>
</tbody>
</table></div>
<p>All of above designs are <em>between-subjects</em> designs without repeated measures. (Note that in the factorial case, we would probably replace <code>a</code> and <code>b</code> with our own deviation-coded numerical predictors, for reasons already discussed in <a href="interactions.html">the chapter on interactions</a>).</p>
<p>Where mixed-effects models come into play is with multilevel data. Data is usually multilevel for one of the three reasons below (multiple reasons could simultaneously apply):</p>
<ol style="list-style-type: decimal">
<li>you have a within-subject factor, and/or</li>
<li>you have <strong>pseudoreplications</strong>, and/or</li>
<li>you have multiple stimulus items (which we will discuss in the <a href="linear-mixed-effects-models-with-crossed-random-factors.html">next chapter</a>).</li>
</ol>
<p>(At this point, it would be a good idea to refresh your memory on the meaning of between- versus within- subject factors). In the <code>sleepstudy</code> data, you had the within-subject factor of <code>Day</code> (which is more a numeric variable, actually, than a factor; but it has multiple values varying within each participant).</p>
<p><strong>Pseudoreplications</strong> occur when you take multiple measurements within the same condition. For instance, imagine a study where you randomly assign participants to consume one of two beverages---alcohol or water---before administering a simple response time task where they press a button as fast as possible when a light flashes. You would probably take more than one measurement of response time for each participant; let's assume that you measured it over 100 trials. You'd have one between-subject factor (beverage) and 100 observations per subject, for say, 20 subjects in each group. One common mistake novices make when analyzing such data is to try to run a t-test. <strong>You can't directly use the conventional a t-test when you have pseudoreplications (or multiple stimuli).</strong> You must first calculate means for each subject, and then run your analysis <strong>on the means, not on the raw data.</strong> There are versions of ANOVA that can deal with pseudoreplications, but you are probably better off using a linear-mixed effects model, which can better handle the complex dependency structure.</p>
<p>Here is a comparison chart for multi-level data:</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="33%">
<col width="30%">
<col width="35%">
</colgroup>
<thead><tr class="header">
<th align="left">test</th>
<th align="left">conventional approach</th>
<th align="left">regression approach</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">one-sample t-test with pseudoreplications</td>
<td align="left">calculate means and use <code><a href="https://rdrr.io/r/stats/t.test.html">t.test(x_mean)</a></code>
</td>
<td align="left"><code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer(y ~ (1 | subject), offset = c)</a></code></td>
</tr>
<tr class="even">
<td align="left">paired samples t-test, no pseudoreplications</td>
<td align="left"><code><a href="https://rdrr.io/r/stats/t.test.html">t.test(x, y, paired = TRUE)</a></code></td>
<td align="left"><code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer(y ~ x + (1 | subject))</a></code></td>
</tr>
<tr class="odd">
<td align="left">paired samples t-test with pseudoreplications</td>
<td align="left">calculate means and use <code><a href="https://rdrr.io/r/stats/t.test.html">t.test(x_mean, y_mean)</a></code>
</td>
<td align="left"><code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer(y ~ x + (1 + x | subject))</a></code></td>
</tr>
<tr class="even">
<td align="left">repeated-measures ANOVA no pseudoreplications</td>
<td align="left"><code><a href="https://rdrr.io/r/stats/aov.html">aov(y ~ x + Error(subject))</a></code></td>
<td align="left"><code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer(y ~ x + (1 | subject))</a></code></td>
</tr>
<tr class="odd">
<td align="left">repeated-measures ANOVA with pseudoreplications</td>
<td align="left"><code><a href="https://rdrr.io/r/stats/aov.html">aov(y ~ x + Error(subject/x))</a></code></td>
<td align="left"><code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer(y ~ x + (1 + x | subject))</a></code></td>
</tr>
<tr class="even">
<td align="left">factorial ANOVA, a &amp; b within, no pseudoreplications</td>
<td align="left"><code><a href="https://rdrr.io/r/stats/aov.html">aov(y ~ a * b + Error(subject))</a></code></td>
<td align="left"><code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer(y ~ a * b + (1 | subject))</a></code></td>
</tr>
<tr class="odd">
<td align="left">factorial ANOVA with pseudoreplications</td>
<td align="left"><code>aov(y ~ a * b + Error(subject/(a * b))</code></td>
<td align="left"><code>lmer(y ~ a * b + (1 + a * b | subject)</code></td>
</tr>
</tbody>
</table></div>
<p>One of the main selling points of the general linear models / regression framework over t-test and ANOVA is its flexibility. We saw this in the last chapter with the <code>sleepstudy</code> data, which could only be properly handled within a linear mixed-effects modelling framework. Despite the many advantages of regression, if you are in a situation where you have balanced data and can reasonably apply t-test or ANOVA without violating any of the assumptions behind the test, it makes sense to do so; these approaches have a long history in psychology and are more widely understood.</p>
</div>
<div id="example-independent-samples-t-test-on-multi-level-data" class="section level2">
<h2>
<span class="header-section-number">6.3</span> Example: Independent-samples <span class="math inline">\(t\)</span>-test on multi-level data<a class="anchor" aria-label="anchor" href="#example-independent-samples-t-test-on-multi-level-data"><i class="fas fa-link"></i></a>
</h2>
<p>Let's consider a situation where you are testing the effect of alcohol consumption on simple reaction time (e.g., press a button as fast as you can after a light appears). To keep it simple, let's assume that you have collected data from 14 participants randomly assigned to perform a set of 10 simple RT trials after one of two interventions: drinking a pint of alcohol (treatment condition) or a placebo drink (placebo condition). You have 7 participants in each of the two groups. Note that you would need more than this for a real study.</p>
<p>This <a href="https://shiny.psy.gla.ac.uk/Dale/icc" target="_blank">web app</a> presents simulated data from such a study. Subjects P01-P07 are from the placebo condition, while subjects T01-T07 are from the treatment condition. Please stop and have a look!</p>
<p>If we were going to run a t-test on these data, we would first need to calculate subject means, because otherwise the observations are not independent. You could do this as follows. (If you want to run the code below, you can download sample data from the web app above and save it as <code>independent_samples.csv</code>).</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/independent_samples.csv"</span>, col_types <span class="op">=</span> <span class="st">"cci"</span><span class="op">)</span>

<span class="va">subj_means</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">subject</span>, <span class="va">cond</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>mean_rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">RT</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>

<span class="va">subj_means</span></code></pre></div>
<pre><code>## # A tibble: 14 × 3
##    subject cond  mean_rt
##    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;
##  1 P01     P        354 
##  2 P02     P        384.
##  3 P03     P        391.
##  4 P04     P        404.
##  5 P05     P        421.
##  6 P06     P        392 
##  7 P07     P        400.
##  8 T08     T        430.
##  9 T09     T        432.
## 10 T10     T        410.
## 11 T11     T        455.
## 12 T12     T        450.
## 13 T13     T        418.
## 14 T14     T        489.</code></pre>
<p>Then, the <span class="math inline">\(t\)</span>-test can be run using the "formula" version of <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code>.</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">mean_rt</span> <span class="op">~</span> <span class="va">cond</span>, <span class="va">subj_means</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  mean_rt by cond
## t = -3.7985, df = 11.32, p-value = 0.002807
## alternative hypothesis: true difference in means between group P and group T is not equal to 0
## 95 percent confidence interval:
##  -76.32580 -20.44563
## sample estimates:
## mean in group P mean in group T 
##        392.3143        440.7000</code></pre>
<p>While there is nothing wrong with this analysis, aggregating the data throws away information. we can see in the above web app that there are actually two different sources of variability: trial-by-trial variability in simple RT (represented by <span class="math inline">\(\sigma\)</span>) and variability across subjects in terms of their how slow or fast they are relative to the population mean (<span class="math inline">\(\gamma_{00}\)</span>). The Data Generating Process for response time (<span class="math inline">\(Y_{st}\)</span>) for subject <span class="math inline">\(s\)</span> on trial <span class="math inline">\(t\)</span> is shown below.</p>
<p><em>Level 1:</em></p>
<p><span class="math display">\[\begin{equation}
Y_{st} = \beta_{0s} + \beta_{1} X_{s} + e_{st}
\end{equation}\]</span></p>
<p><em>Level 2:</em></p>
<p><span class="math display">\[\begin{equation}
\beta_{0s} = \gamma_{00} + S_{0s}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\beta_{1} = \gamma_{10}
\end{equation}\]</span></p>
<p><em>Variance Components:</em></p>
<p><span class="math display">\[\begin{equation}
S_{0s} \sim N\left(0, {\tau_{00}}^2\right) 
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
e_{st} \sim N\left(0, \sigma^2\right)
\end{equation}\]</span></p>
<p>In the above equation, <span class="math inline">\(X_s\)</span> is a numerical predictor coding which condition the subject <span class="math inline">\(s\)</span> is in; e.g., 0 for placebo, 1 for treatment.</p>
<p>The multi-level equations are somewhat cumbersome for such a simple model; we could just reduce levels 1 and 2 to</p>
<p><span class="math display">\[\begin{equation}
Y_{st} = \gamma_{00} + S_{0s} + \gamma_{10} X_s + e_{st},
\end{equation}\]</span></p>
<p>but it is worth becoming familiar with the multi-level format for when we encounter more complex designs.</p>
<p>Unlike the <code>sleepstudy</code> data seen in the last chapter, we only have one random effect for each subject, <span class="math inline">\(S_{0s}\)</span>. There is no random slope. Each subject appears in only one of the two treatment conditions, so it would not be possible to estimate how the effect of placebo versus alcohol varies over subjects. The mixed-effects model that we would fit to these data, with random intercepts but no random slopes, is known as a <strong>random intercepts model</strong>.</p>
<p>A random-intercepts model would adequately capture the two sources of variability mentioned above: the inter-subject variability in overall mean RT in the parameter <span class="math inline">\({\tau_{00}}^2\)</span>, and the trial-by-trial variability in the parameter <span class="math inline">\(\sigma^2\)</span>. We can calculate the proportion of the total variability attributable to individual differences among subjects using the formula below.</p>
<p><span class="math display">\[ICC = \frac{{\tau_{00}}^2}{{\tau_{00}}^2 + \sigma^2}\]</span></p>
<p>This quantity, known as the <strong>intra-class correlation coefficient</strong>, and tells you how much clustering there is in your data. It ranges from 0 to 1, with 0 indicating that all the variability is due to residual variance, and 1 indicating that all the variability is due to individual differences among subjects.</p>
<p>The lmer syntax for fitting a random intercepts model to the data is <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer(RT ~ cond + (1 | subject), dat, REML=FALSE)</a></code>. Let's create our own numerical predictor first, to make it explicit that we are using dummy coding.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>cond_d <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">cond</span> <span class="op">==</span> <span class="st">"T"</span>, <span class="fl">1L</span>, <span class="fl">0L</span><span class="op">)</span><span class="op">)</span>

<span class="fu">distinct</span><span class="op">(</span><span class="va">dat2</span>, <span class="va">cond</span>, <span class="va">cond_d</span><span class="op">)</span>  <span class="co">## double check</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   cond  cond_d
##   &lt;chr&gt;  &lt;int&gt;
## 1 P          0
## 2 T          1</code></pre>
<p>And now, estimate the model.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lme4/lme4/">"lme4"</a></span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">RT</span> <span class="op">~</span> <span class="va">cond_d</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>, <span class="va">dat2</span>, REML <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood  ['lmerMod']
## Formula: RT ~ cond_d + (1 | subject)
##    Data: dat2
## 
##      AIC      BIC   logLik deviance df.resid 
##   1451.8   1463.5   -721.9   1443.8      136 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.67117 -0.66677  0.01656  0.75361  2.58447 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  subject  (Intercept)  329.3   18.15   
##  Residual             1574.7   39.68   
## Number of obs: 140, groups:  subject, 14
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  392.314      8.339  47.045
## cond_d        48.386     11.793   4.103
## 
## Correlation of Fixed Effects:
##        (Intr)
## cond_d -0.707</code></pre>
<p>Play around with the sliders in the app above and check the lmer output panel until you understand how the output maps onto the model parameters.</p>
<div id="when-is-a-random-intercepts-model-appropriate" class="section level3">
<h3>
<span class="header-section-number">6.3.1</span> When is a random-intercepts model appropriate?<a class="anchor" aria-label="anchor" href="#when-is-a-random-intercepts-model-appropriate"><i class="fas fa-link"></i></a>
</h3>
<p>Of course, a mixed-effects model is only appropriate when you have multilevel data. The random-intercepts model is appropriate for any one-sample or between-subjects data with pseudoreplications (if you don't have pseudoreplications in this situation, you don't have multilevel data, and you can just use vanilla regression, e.g., <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>).</p>
<p>The "random-intercepts-only" model is also appropriate when you have within-subject factors in your design, but <strong>only if you don't also have pseudoreplications</strong>; that is, it is <strong>only</strong> appropriate when you have a single observation per subject per level of the within-subject factor. If you have more than one observation per subject per level/cell, you need to enrich your random effects structure with random slopes, as described in the next section. If the reason you have multiple observations per subject per level is because you have each subject reacting to the same set of stimuli, then you might want to consider a mixed-effects model with crossed random effects for subjects and stimuli, as described in the <a href="linear-mixed-effects-models-with-crossed-random-factors.html">next chapter</a>.</p>
<p>The same logic goes for factorial designs in which there is more than one within-subjects factor. In factorial designs, the random-intercepts model is appropriate if you have one observation per subject per <strong>cell</strong> formed by each combination of the within-subjects factors. For instance, if <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are two two-level within-subject factors, you need to check that you have only one observation for each subject in <span class="math inline">\(A_1B_1\)</span>, <span class="math inline">\(A_1B_2\)</span>, <span class="math inline">\(A_2B_1\)</span>, and <span class="math inline">\(A_2B_2\)</span>. If you have more than one observation, you will need to consider including a random slope in your model.</p>
</div>
</div>
<div id="expressing-the-study-design-and-performing-tests-in-regression" class="section level2">
<h2>
<span class="header-section-number">6.4</span> Expressing the study design and performing tests in regression<a class="anchor" aria-label="anchor" href="#expressing-the-study-design-and-performing-tests-in-regression"><i class="fas fa-link"></i></a>
</h2>
<p>In order to reproduce all of the t-test/ANOVA-style analyses in linear mixed-effects models, you'll need to better understand two things: (1) how to express your study design in a regression formula, and (2) how to get p-values for any tests you perform. The latter part is not obvious within the linear mixed-effects approach, since in many circumstances, the output of <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lme4::lmer()</a></code> does not give you p-values by default, reflecting the fact that there are multiple options for deriving them <span class="citation">(Luke, <a href="bibliography.html#ref-Luke_2017">2017</a>)</span>. Or, you might get p-values for individual regression coefficients, but the test you want to perform is a composite one where you need to test multiple parameters simultaneously.</p>
<p>First, let's take a closer look at the regression formula syntax in R and <strong><code>lme4</code></strong>. For the regression model <span class="math inline">\(y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \ldots + \beta_m x_m + e\)</span> with by-subject random effects you'd have:</p>
<p><code>y ~ 1 + x1 + x2 + ... + xm + (1 + x1 + ... | subject)</code></p>
<p>The residual term is implied and so not mentioned; only the predictors. The left side (before the tilde <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>) specifies the response variable, the right side has the predictor variables. The term in brackets, <code>(... | ...)</code>, is specific to <strong><code>lme4</code></strong>. The right side of the vertical bar <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> specifies the name of a variable (in this case, <code>subject</code>) that codes the levels of the random factor. The left side specifies what regression coefficients you want to allow to vary over those levels. The <code>1</code> at the start of the formula specifies that you want an intercept, which is included by default anyway, and so can be omitted. The <code>1</code> within the bracket specifies a <strong>random intercept</strong>, which is also included by default; the predictor variables mentioned inside the brackets specify <strong>random slopes</strong>. So you could write the above formula equivalently as:</p>
<p><code>y ~ x1 + x2 + ... + xm + (x1 + ... | subject)</code>.</p>
<p>There is another important type of shortcut in R formulas, which we already saw in the <a href="interactions.html">chapter on interactions</a>; namely the "star syntax" <code>a * b</code> for specifying interactions. If you have two factors, <code>a</code> and <code>b</code> in your design, and you want all main effects and interactions in the model, you can use:</p>
<p><code>y ~ a * b</code></p>
<p>which is equivalent to <code>y ~ a + b + a:b</code> where <code>a</code> and <code>b</code> are the predictors coding main effects of A and B respectively, and <code>a:b</code> codes the AB interaction. It saves a lot of typing (and mistakes) to use the star syntax for interactions rather than spelling them out. This can be seen more easily in the example below, which codes a 2x2x2 factorial design including factors A, B, and C:</p>
<p><code>y ~ a * b * c</code></p>
<p>which is equivalent to</p>
<p><code>y ~ a + b + c + a:b + a:c + b:c + a:b:c</code></p>
<p>where <code>a:b</code>, <code>a:c</code>, and <code>b:c</code> are two-way interactions and <code>a:b:c</code> is the three-way interaction. You can use the star syntax inside the brackets for the random effects term as well, e.g.,</p>
<p><code>y ~ a * b * c + (a * b * c | subject)</code></p>
<p>is equivalent to</p>
<p><code>y ~ a + b + c + a:b + a:c + b:c + a:b:c + (a + b + c + a:b + a:c + b:c + a:b:c | subject)</code></p>
<p>which, despite its complexity, is a design that is not that uncommon in psychology (e.g., if you have all factors within and multiple stimuli per condition)!</p>
<div id="factors-with-more-than-two-levels" class="section level3">
<h3>
<span class="header-section-number">6.4.1</span> Factors with more than two levels<a class="anchor" aria-label="anchor" href="#factors-with-more-than-two-levels"><i class="fas fa-link"></i></a>
</h3>
<p>As noted above, you could conduct a one-factor ANOVA in regression using the formula <code><a href="https://rdrr.io/r/stats/lm.html">lm(y ~ x)</a></code> for single-level or <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer(y ~ x + (1 | subject))</a></code> for the multilevel version without pseudoreplications. In the formula, the <code>x</code> predictor would be of type <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>, which R would (by default) convert to <span class="math inline">\(k-1\)</span> dummy-coded numerical predictors (one for each level; see the <a href="interactions.html">interaction chapter</a> for information).</p>
<p>It is often sensible to code your own numerical predictors, particularly if your goal is to do ANOVA-style tests of main effects and interactions, which can be difficult if any of your variables are of type <code>factor</code>. So for a design with one three-level factor called <code>meal</code> (<code>breakfast</code>, <code>lunch</code>, <code>dinner</code>) you could create two variables, <code>lunch_v_breakfast</code> and <code>dinner_v_breakfast</code> following the scheme below.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">factor level</th>
<th align="right">lunch_v_breakfast</th>
<th align="right">dinner_v_breakfast</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">breakfast</td>
<td align="right">-1/3</td>
<td align="right">-1/3</td>
</tr>
<tr class="even">
<td align="left">lunch</td>
<td align="right">+2/3</td>
<td align="right">-1/3</td>
</tr>
<tr class="odd">
<td align="left">dinner</td>
<td align="right">-1/3</td>
<td align="right">+2/3</td>
</tr>
</tbody>
</table></div>
<p>If your dependent variable is <code>calories</code>, your model would be:</p>
<p><code>calories ~ lunch_v_breakfast + dinner_v_breakfast</code>.</p>
<p>But what if you wanted to interact <code>meal</code> with another two-level factor---say, <code>time_of_week</code> (<code>weekday</code> versus <code>weekend</code>, coded as -.5 and +.5 respectively), because you think the calories consumed per meal would differ across the levels of this variable? Then your model would be:</p>
<p><code>calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_of_week</code>.</p>
<p><a href="interactions.html#coding-schemes-for-categorical-variables">(The inclusion of an interaction is the reason we chose the "deviation" coding scheme.)</a>. We put brackets around the predictors associated with the two-level variable so that each one interacts with <code>time_of_week</code>. The above star syntax is shorthand for:</p>
<p><code>calories ~ lunch_v_breakfast + dinner_v_breakfast + time_of_week + lunch_v_breakfast:time_of_week + dinner_v_breakfast:time_of_week</code>.</p>
<p>This is the "regression way" of estimating parameters for a 3x2 factorial design.</p>
</div>
<div id="multiparameter-tests" class="section level3">
<h3>
<span class="header-section-number">6.4.2</span> Multiparameter tests<a class="anchor" aria-label="anchor" href="#multiparameter-tests"><i class="fas fa-link"></i></a>
</h3>
<p>Whenever you are dealing with designs where all categorical factors have no more than two levels, the test of the regression coefficient associated with a given factor will be equivalent to the test for the effect in the ANOVA framework, provided you use <a href="multiple-regression.html#dealing-with-categorical-predictors">sum or deviation coding</a>. But in the above example, we have a 3x2 design, with two predictor variables coding the main effect of <code>meal</code> (<code>lunch_v_breakfast</code> and <code>dinner_v_breakfast</code>). Let's simulate some data and run a one-factor ANOVA with <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code>, and then we'll replicate the analysis using the regression function <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> (note that the same procedure works for mixed-effects models on multilevel data, just using <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lme4::lmer()</a></code> instead of <code>base::lm()</code>).</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## make up some data</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">62</span><span class="op">)</span>
<span class="va">meals</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>meal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"breakfast"</span>, <span class="st">"lunch"</span>, <span class="st">"dinner"</span><span class="op">)</span>,
                                  each <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,
                time_of_week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"weekday"</span>, <span class="st">"weekend"</span><span class="op">)</span>,
                                              each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,
                calories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">450</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>

<span class="co">## use sum coding instead of default 'dummy' (treatment) coding</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>unordered <span class="op">=</span> <span class="st">"contr.sum"</span>, ordered <span class="op">=</span> <span class="st">"contr.poly"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">calories</span> <span class="op">~</span> <span class="va">meal</span> <span class="op">*</span> <span class="va">time_of_week</span>, data <span class="op">=</span> <span class="va">meals</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##                   Df Sum Sq Mean Sq F value Pr(&gt;F)
## meal               2   2164    1082   0.380  0.692
## time_of_week       1   5084    5084   1.783  0.207
## meal:time_of_week  2   4767    2384   0.836  0.457
## Residuals         12  34209    2851</code></pre>
<p>We get three <span class="math inline">\(F\)</span>-tests, one for each main effect (<code>meal</code> and <code>time_of_week</code>) one for the interaction. What happens if we fit a model using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>?</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## add our own numeric predictors</span>
<span class="va">meals2</span> <span class="op">&lt;-</span> <span class="va">meals</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>lunch_v_breakfast <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">meal</span> <span class="op">==</span> <span class="st">"lunch"</span>, <span class="fl">2</span><span class="op">/</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,
         dinner_v_breakfast <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">meal</span> <span class="op">==</span> <span class="st">"dinner"</span>, <span class="fl">2</span><span class="op">/</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,
         time_week <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">time_of_week</span> <span class="op">==</span> <span class="st">"weekend"</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="co">## double check our coding</span>
<span class="fu">distinct</span><span class="op">(</span><span class="va">meals2</span>, <span class="va">meal</span>, <span class="va">time_of_week</span>,
         <span class="va">lunch_v_breakfast</span>, <span class="va">dinner_v_breakfast</span>, <span class="va">time_week</span><span class="op">)</span>

<span class="co">## fit regression model</span>
<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">calories</span> <span class="op">~</span> <span class="op">(</span><span class="va">lunch_v_breakfast</span> <span class="op">+</span> <span class="va">dinner_v_breakfast</span><span class="op">)</span> <span class="op">*</span>
            <span class="va">time_week</span>, data <span class="op">=</span> <span class="va">meals2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   meal      time_of_week lunch_v_breakfast dinner_v_breakfast time_week
##   &lt;fct&gt;     &lt;fct&gt;                    &lt;dbl&gt;              &lt;dbl&gt;     &lt;dbl&gt;
## 1 breakfast weekday                 -0.333             -0.333      -0.5
## 2 breakfast weekend                 -0.333             -0.333       0.5
## 3 lunch     weekday                  0.667             -0.333      -0.5
## 4 lunch     weekend                  0.667             -0.333       0.5
## 5 dinner    weekday                 -0.333              0.667      -0.5
## 6 dinner    weekend                 -0.333              0.667       0.5
## 
## Call:
## lm(formula = calories ~ (lunch_v_breakfast + dinner_v_breakfast) * 
##     time_week, data = meals2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -68.522 -35.895  -4.063  42.061  73.081 
## 
## Coefficients:
##                              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                    451.15      12.58  35.848 1.42e-13 ***
## lunch_v_breakfast              -25.23      30.83  -0.818    0.429    
## dinner_v_breakfast             -20.59      30.83  -0.668    0.517    
## time_week                       33.61      25.17   1.335    0.207    
## lunch_v_breakfast:time_week    -58.31      61.65  -0.946    0.363    
## dinner_v_breakfast:time_week    17.93      61.65   0.291    0.776    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 53.39 on 12 degrees of freedom
## Multiple R-squared:  0.2599, Adjusted R-squared:  -0.04843 
## F-statistic: 0.843 on 5 and 12 DF,  p-value: 0.5447</code></pre>
<p>OK, this output looks very different! How do you perform ANOVA-like tests in those situations? You have estimates for <code>lunch_v_breakfast</code> and <code>dinner_v_breakfast</code> but how would you convert this into a single test for the main effect of <code>meal</code>? Likewise, you have two interaction terms, <code>lunch_v_breakfast:tow</code> and <code>dinner_v_breakfast:tow</code>; how do you convert this into a single test for the interaction?</p>
<p>The solution is to perform <strong>multiparameter tests</strong> using model comparison, implemented by the <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> function in R. To test for the main effect of <code>meal</code>, you'd compare a model containing the two predictor variables coding that factor (<code>lunch_v_breakfast</code> and <code>dinner_v_breakfast</code>) to a model excluding these two predictors but that is otherwise identical. You can either re-fit the model by writing it out and excluding the terms, or by using the <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> function and removing the terms (which is a shortcut). Let's write it out first.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## fit the model</span>
<span class="va">mod_main_eff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">calories</span> <span class="op">~</span> <span class="va">time_week</span> <span class="op">+</span>
                     <span class="va">lunch_v_breakfast</span><span class="op">:</span><span class="va">time_week</span> <span class="op">+</span> <span class="va">dinner_v_breakfast</span><span class="op">:</span><span class="va">time_week</span>,
                   <span class="va">meals2</span><span class="op">)</span>

<span class="co">## compare models</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">mod_main_eff</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_week
## Model 2: calories ~ time_week + lunch_v_breakfast:time_week + dinner_v_breakfast:time_week
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1     12 34209                           
## 2     14 36373 -2   -2163.9 0.3795 0.6921</code></pre>
<p>OK, now here is an equivalent version using the shortcut <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> function, which takes the model you want to update as the first argument and then a special syntax for the formula including your changes. For the formula, we use <code>. ~ . -lunch_v_breakfast -dinner_v_breakfast~</code> Although this formula seems weird, the dot <code>.</code> says "keep everything on this side of the model formula (left of <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>) as it is in the original model." So the formula <code>. ~ .</code> would use the same formula as the original model; that is, <code><a href="https://rdrr.io/r/stats/update.html">update(mod, . ~ .)</a></code> would fit the exact same model as above. In contrast, <code>. ~ . -x -y</code> means "everything the same on the left side (same DV), but remove variables <code>x</code> and <code>y</code> from the right side.</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_main_eff2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span><span class="va">lunch_v_breakfast</span> <span class="op">-</span><span class="va">dinner_v_breakfast</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">mod_main_eff2</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_week
## Model 2: calories ~ time_week + lunch_v_breakfast:time_week + dinner_v_breakfast:time_week
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1     12 34209                           
## 2     14 36373 -2   -2163.9 0.3795 0.6921</code></pre>
<p>As you can see, this gives us the same result as above.</p>
<p>If we want to test the main effect of <code>time_of_week</code>, we remove that predictor.</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_tow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span><span class="va">time_week</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">mod_tow</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_week
## Model 2: calories ~ lunch_v_breakfast + dinner_v_breakfast + lunch_v_breakfast:time_week + 
##     dinner_v_breakfast:time_week
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1     12 34209                           
## 2     13 39294 -1   -5084.1 1.7834 0.2065</code></pre>
<p>Try to figure out how to test the interaction on your own.</p>
<div class="webex-solution">
<button>
Click to see solution
</button>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_interact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span><span class="va">lunch_v_breakfast</span><span class="op">:</span><span class="va">time_week</span>
                       <span class="op">-</span><span class="va">dinner_v_breakfast</span><span class="op">:</span><span class="va">time_week</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">mod_interact</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_week
## Model 2: calories ~ lunch_v_breakfast + dinner_v_breakfast + time_week
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1     12 34209                           
## 2     14 38977 -2   -4767.4 0.8362 0.4571</code></pre>
</div>
<p>We got the exact same results doing model comparison with <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> as we did using <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code>. Although this involved more steps, it is worth learning this approach as it will ultimately give you much more flexibility.</p>

</div>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("webex-total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("webex-correct").length + " of " +
      document.getElementsByClassName("webex-solveme").length + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );
});
</script><div class="chapter-nav">
<div class="prev"><a href="introducing-linear-mixed-effects-models.html"><span class="header-section-number">5</span> Introducing Linear Mixed-Effects Models</a></div>
<div class="next"><a href="linear-mixed-effects-models-with-crossed-random-factors.html"><span class="header-section-number">7</span> Linear mixed-effects models with crossed random factors</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#linear-mixed-effects-models-with-one-random-factor"><span class="header-section-number">6</span> Linear mixed-effects models with one random factor</a></li>
<li><a class="nav-link" href="#learning-objectives-1"><span class="header-section-number">6.1</span> Learning objectives</a></li>
<li><a class="nav-link" href="#when-and-why-would-you-want-to-replace-conventional-analyses-with-linear-mixed-effects-modeling"><span class="header-section-number">6.2</span> When, and why, would you want to replace conventional analyses with linear mixed-effects modeling?</a></li>
<li>
<a class="nav-link" href="#example-independent-samples-t-test-on-multi-level-data"><span class="header-section-number">6.3</span> Example: Independent-samples \(t\)-test on multi-level data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#when-is-a-random-intercepts-model-appropriate"><span class="header-section-number">6.3.1</span> When is a random-intercepts model appropriate?</a></li></ul>
</li>
<li>
<a class="nav-link" href="#expressing-the-study-design-and-performing-tests-in-regression"><span class="header-section-number">6.4</span> Expressing the study design and performing tests in regression</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#factors-with-more-than-two-levels"><span class="header-section-number">6.4.1</span> Factors with more than two levels</a></li>
<li><a class="nav-link" href="#multiparameter-tests"><span class="header-section-number">6.4.2</span> Multiparameter tests</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/stat-models-v1/blob/master/06-linear-mixed-effects-one.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/stat-models-v1/edit/master/06-linear-mixed-effects-one.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Learning Statistical Models Through Simulation in R</strong>" was written by Dale J. Barr. It was last built on 2021-10-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
